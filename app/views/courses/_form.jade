form(method='POST', id='courseForm')
  p
    label(for="title") Title:
    input(value='#{course.title}', id='title', name='title', class='required')
  - if (!user.loggedIn && !course._id)
    p
      label(for="email") Email Address:
      input(value='', id='email', name='email', class='required email')
  p
    label(for="category") Category:
    select(name="category", id="category")
      option(value="#{course.category}") -- Select Category #{course.category} --
      - each category in categories
        - if (category.name === course.category)
          option(value="#{category.name}", selected="selected") #{category.name}
        - else
          option(value="#{category.name}") #{category.name}
    button(id='addCategory', type="button", class="btn", style="margin-left: 10px;") +
  p
    label(for="content") Content:
    textarea(name='content', id='content', class='required')
      #{course.content}
  p
    input(type='submit', value='Submit')

#addCategoryModal.modal(style="display:none;")
  form(method='post', action='/categories/create')
    .modal-header
      a.close(data-dismiss="modal") x
      h3 Add Category
    .modal-body
      p
        label(for="name") Name:
        input(value='', id='catName', name='name', class='required')
    .modal-footer
      a(href="#", class="btn") Close
      button(href="#", class="btn btn-primary") Add

script(type='text/javascript')
  $('#addCategory').click(function(e){
    $('#addCategoryModal').modal();
    return false;
  });

  $('#addCategoryModal .btn-primary').click(function(e){
    $.ajax({
      url: '/categories/create',
      type: 'POST',
      data: {
        name: $('#catName').val()
      },
      dataType: 'json',
      success: function(res) {
        $('#addCategoryModal').modal('hide');
        console.log(res.success);
        if(res.success) {
          $('#category').append($('<option/>', {
            value: $('#catName').val(),
            html: $('#catName').val()
          }));
        }
      },
      error: function(xhr, b, err) {
        console.log(err);
      }
    });
    return false;
  });
